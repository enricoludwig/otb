<!DOCTYPE html>
<html ng-app="custom-webapp-ui" lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>OWN TIME BOT</title>

        <link rel="stylesheet" href="flip/flip.min.css" />
        <style>
            .tick {
                padding-bottom: 1em;
                font-size: 1rem;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans,
                    Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
            }

            .tick-label {
                font-size: 0.375em;
                text-align: center;
            }

            .tick-group {
                margin: 0 0.25em;
                text-align: center;
            }

            .tick-credits {
                display: none !important;
            }
        </style>

        <!-- Load the Telegram Library -->
        <script src="https://telegram.org/js/telegram-web-app.js"></script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
        <link rel="stylesheet" href="css/style.css">
    </head>

    <body>

        <header>
            <h1>OWN TIME BOT</h1>
        </header>

        <div class="subtitle" style="display: block; width: 365px; max-width: 90vw; margin-left: auto; margin-right: auto;">
            <p>Your Local Time of Event:</p>
            <div class="input-group">
                <button class="input-group-text" id="btnDateSub">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-left" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223"/>
                    </svg>
                </button>
                <!--<p id="date" style="font-weight: bold;">Wednesday, 12/25/2024</p>-->
                
                <input type="text" readonly class="form-control form-control-lg text-center" placeholder="date" id="date">
                                        
                <button class="input-group-text" id="btnDateAdd">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6.776 1.553a.5.5 0 0 1 .671.223l3 6a.5.5 0 0 1 0 .448l-3 6a.5.5 0 1 1-.894-.448L9.44 8 6.553 2.224a.5.5 0 0 1 .223-.671"/>
                    </svg>
                </button>
            </div>
        </div>




        <div style="display: block; width: 400px; max-width: 95vw; margin-left: auto; margin-right: auto;">
            <div class="container text-center">
                <div class="row">
                    <div class="col">


                        <div class="btn-group-vertical" role="group" aria-label="Vertical button group">
                            <button class="input-group-text" id="btnHourAdd">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-up" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M7.776 5.553a.5.5 0 0 1 .448 0l6 3a.5.5 0 1 1-.448.894L8 6.56 2.224 9.447a.5.5 0 1 1-.448-.894z"/>
                                </svg>
                            </button>
                                                    
                            <button class="input-group-text" id="btnHourSub">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-down" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67"/>
                                </svg>
                            </button>
                        </div>


                    </div>
                    <div class="col">


                        <div class="tick" data-did-init="handleTickInit1" style="display: block; width: 220px; max-width: 55vw; margin-left: auto; margin-right: auto;">

                            <div data-layout="horizontal center fit">
            
                                <span data-key="hours" data-repeat="true" data-transform="pad(00) -> split -> delay">
                                    <span data-view="flip"></span>
                                </span>
            
                                <span class="tick-text-inline">:</span>
            
                                <span data-key="minutes" data-repeat="true" data-transform="pad(00) -> split -> delay">
                                    <span data-view="flip"></span>
                                </span>
            
                            </div>
                        </div>


                    </div>
                    <div class="col">


                        <div class="btn-group-vertical" role="group" aria-label="Vertical button group">
                            <button class="input-group-text" id="btnMinuteAdd">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-up" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M7.776 5.553a.5.5 0 0 1 .448 0l6 3a.5.5 0 1 1-.448.894L8 6.56 2.224 9.447a.5.5 0 1 1-.448-.894z"/>
                                </svg>
                            </button>
                                                    
                            <button class="input-group-text" id="btnMinuteSub">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-down" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67"/>
                                </svg>
                            </button>
                        </div>


                    </div>

            </div>
        </div>



        <div class="subtitle">Countdown:</div>
        
        <div class="tick" data-did-init="handleTickInit2" style="display: block; width: 380px; max-width: 95vw; margin-left: auto; margin-right: auto;">
            <div
                data-repeat="true"
                data-layout="horizontal center fit"
                data-transform="preset(d, h, m, s) -> delay"
            >
                <div class="tick-group">
                    <div
                        data-key="value"
                        data-repeat="true"
                        data-transform="pad(00) -> split -> delay"
                    >
                        <span data-view="flip"></span>
                    </div>
                    <!--<span data-key="label" data-view="text" class="tick-label"></span>-->
                </div>
            </div>
        </div>

        <div class="subtitle"></div>

        <div class="d-grid gap-2" style="width: 365px; max-width: 90vw; margin-left: auto; margin-right: auto;">
            <button class="btn btn-lg btn-light" id="btnCopy">Copy link</button>
        </div>
        <!--
        <div id="ad_container">
            <p><i>Your Ad Here</i></p>
        </div>
        -->
        <script>
            const tg = window.Telegram.WebApp;

            let now = new Date();
            let alert_date = new Date();
            alert_date.setHours(alert_date.getHours() + 4, 0, 0);

            let start_param = tg.initDataUnsafe.start_param;
            if(start_param) {
                let unix_timestamp = parseInt(start_param);
                alert_date = new Date(unix_timestamp * 1000);
            }

            let setDate = document.getElementById("date");
            setDate.value = alert_date.toLocaleDateString();
            
            let tick1;
            function handleTickInit1(tick) {
                if(!tick1) tick1 = tick;
                tick.value = {
                    date: alert_date.getDate(),
                    month: alert_date.getMonth() + 1,
                    year: alert_date.getFullYear(),
                    hours: alert_date.getHours(),
                    minutes: alert_date.getMinutes(),
                    seconds: alert_date.getSeconds()
                };
            }

            let tick2;
            function handleTickInit2(tick) {
                if(!tick2) tick2 = tick;
                Tick.count.down(alert_date).onupdate = function (value) {
                    tick.value = value;
                    console.log(value);
                };
            }
        </script>

        <script src="flip/flip.min.js"></script>






        <script> 
            let btnCopy = document.getElementById("btnCopy");
            btnCopy.addEventListener("click", () => {
                // Create a fake `textarea` and set the contents to the text you want to copy    
                const storage = document.createElement('textarea');
                storage.value = "https://t.me/owntimebot?startapp=" + Math.trunc(alert_date.valueOf() / 1000);
                btnCopy.appendChild(storage);

                // Copy the text in the fake `textarea` and remove the `textarea`
                storage.select();
                storage.setSelectionRange(0, 99999);
                document.execCommand('copy');
                btnCopy.removeChild(storage);
                btnCopy.innerHTML = `Copied 
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-check-all" viewBox="0 0 16 16">
                    <path d="M8.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L2.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093L8.95 4.992zm-.92 5.14.92.92a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 1 0-1.091-1.028L9.477 9.417l-.485-.486z"/>
                </svg>`;
            });

            setDate.value = alert_date.toLocaleDateString();
            refreshLink();

            let btnDateSub = document.getElementById("btnDateSub");
            btnDateSub.addEventListener("click", () => {
                alert_date.setDate(alert_date.getDate() - 1);
                setDate.value = alert_date.toLocaleDateString();
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });

            let btnDateAdd = document.getElementById("btnDateAdd");
            btnDateAdd.addEventListener("click", () => {
                alert_date.setDate(alert_date.getDate() + 1);
                setDate.value = alert_date.toLocaleDateString();
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });

            let btnHourSub = document.getElementById("btnHourSub");
            btnHourSub.addEventListener("click", () => {
                alert_date.setHours(alert_date.getHours() - 1);
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });

            let btnHourAdd = document.getElementById("btnHourAdd");
            btnHourAdd.addEventListener("click", () => {
                alert_date.setHours(alert_date.getHours() + 1);
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });
            

            let btnMinuteSub = document.getElementById("btnMinuteSub");
            btnMinuteSub.addEventListener("click", () => {
                alert_date.setMinutes(alert_date.getMinutes() - 5);
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });

            let btnMinuteAdd = document.getElementById("btnMinuteAdd");
            btnMinuteAdd.addEventListener("click", () => {
                alert_date.setMinutes(alert_date.getMinutes() + 5);
                refreshLink();
                handleTickInit1(tick1);
                handleTickInit2(tick2);
            });

            function refreshLink() {
                btnCopy.innerHTML = `Copy link`;
            }


        </script>

    </body>
</html>
